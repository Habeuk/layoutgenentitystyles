<?php

/**
 *
 * @file
 * Primary module hooks for layout generate entity styles module.
 *
 * @DCG
 * This file is no longer required in Drupal 8.
 * @see https://www.drupal.org/node/2217931
 */
use Stephane888\Debug\Repositories\ConfigDrupal;

/**
 * *
 * hook_ENTITY_TYPE_presave
 */
function layoutgenentitystyles_entity_view_display_presave($entity) {
  $configs = ConfigDrupal::config('layoutgenentitystyles.settings');
  if (!empty($configs['enabled_auto_generate_config'])) {
    \Drupal::messenger()->addStatus("Les styles (scss/js) maj via l'entité de configuration", true);
    if (method_exists($entity, 'getSections')) {
      /**
       *
       * @var \Drupal\layoutgenentitystyles\Services\LayoutgenentitystylesServices $style
       */
      $style = \Drupal::getContainer()->get('layoutgenentitystyles.add.style.theme');
      $style->generateSTyleFromEntity($entity);
    }
  }
}

//
/**
 * *
 * hook_ENTITY_TYPE_presave
 */
function layoutgenentitystyles_entity_presave($entity) {
  $configs = ConfigDrupal::config('layoutgenentitystyles.settings');
  if (!empty($configs['enabled_auto_generate_entity'])) {
    \Drupal::messenger()->addStatus("Les styles (scss/js) maj via une entité surchargée", true);
    if (method_exists($entity, 'hasField'))
      if ($entity->hasField('layout_builder__layout')) {
        $sections = [];
        $listSetions = $entity->get('layout_builder__layout')->getValue();
        $section_storage = $entity->getEntityTypeId() . '.' . $entity->bundle() . '.' . $entity->id();
        dump($section_storage);
        // dump($entity->bundle());
        // dump($entity->id());
        // dump($entity->);
        foreach ($listSetions as $value) {
          $sections[] = reset($value);
        }
        /**
         *
         * @var \Drupal\layoutgenentitystyles\Services\LayoutgenentitystylesServices $style
         */
        $style = \Drupal::getContainer()->get('layoutgenentitystyles.add.style.theme');
        $style->generateStyleFromSection($sections, $section_storage);
        // dump($style->getLibraries());
      }
  }
}

